<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/stylesheets/stars.css"/>

<section class="row">
    <div class="col-6">
        <div id="campgroundCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <% if(campground.images.length > 0) { %>
                <% campground.images.forEach((img, i) => { %>
                    <!-- To set the 1st image in the slide -->
                <div class="carousel-item <%= i === 0 ? 'active' : '' %>">
                    <img src="<%= img.url %>" class="d-block w-100" alt="camp-slide-image">
                </div>
                <% }) %>
                <% } else { %>
                    <!-- if campground have no image then set it to some default image -->
                    <img class="img-fluid" src="https://res.cloudinary.com/dkrwyznvg/image/upload/v1632753128/seeder/no_image_placeholder_rhcxzu.png" alt="no-image">
                <% } %>
            </div>
            <!-- Show navigation butttons for the slide iff there are more than 1 images -->
            <% if (campground.images.length > 1) { %>
            <button class="carousel-control-prev" type="button" data-bs-target="#campgroundCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#campgroundCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
            <% } %>
        </div>
        <div class="card mb-3">
            <div class="card-body">
            <h5 class="card-title"><%= campground.title %></h5>
            <p class="card-text"><%= campground.description %></p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><%= campground.location %></li>
                <li class="list-group-item">$<%= campground.price %>/night</li>
                <li class="list-group-item">Submitted By <a href="#"><%= campground.author.username %></a></li>
            </ul>
            <% if (currentUser && campground.author._id.equals(currentUser._id)) { %>
                <div class="card-body">
                    <a class="card-link btn btn-primary" href="/campgrounds/<%= campground._id %>/edit">Edit</a>
                    <form class="d-inline" action="/campgrounds/<%= campground._id %>?_method=DELETE" method="POST">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>
            <% } %>
            <div class="card-footer text-muted">
                <%= new Date(campground.createdAt).toDateString() %>
            </div>
        </div>
    </div>
    <div class="col-6">
        <div id='map'></div> <!-- To display map -->
        <% if (currentUser) { %>
            <h2>Leave a Review</h2>
            <form action="/campgrounds/<%= campground._id %>/reviews" method="POST" class="mb-3 validated-form" novalidate>
                <div>
                    <fieldset class="starability-basic">
                        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
                        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                        <label for="first-rate1" title="Terrible">1 star</label>
                        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                        <label for="first-rate2" title="Not good">2 stars</label>
                        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                        <label for="first-rate3" title="Average">3 stars</label>
                        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                        <label for="first-rate4" title="Very good">4 stars</label>
                        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                        <label for="first-rate5" title="Amazing">5 stars</label>
                    </fieldset>
                </div>
                <div class="mb-3">
                    <label for="body" class="form-label">Review Text:</label>
                    <textarea name="review[body]" id="body" class="form-control" cols="30" rows="3" required></textarea>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                </div>
                <button class="btn btn-success">Submit</button>
            </form>
        <% } %>
        <% for (let review of campground.reviews) { %>
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title"><%= review.author.username %></h5>
                    <p class="starability-result" data-rating="<%= review.rating %>">
                        Rated: <%= review.rating %> stars <!-- this line is for accessibilty like screen reader, etc -->
                    </p>
                    <p class="card-text">Review: <%= review.body %></p>
                    <% if (currentUser && review.author._id.equals(currentUser._id)) { %>
                    <form action="/campgrounds/<%= campground._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </form>
                    <% } %>
                </div>
            </div>
        <% } %>
    </div>
</section>


<!-- Below script handing the required data from server to client side,
     instead of below script you can make an API endpoint and use AJAX in showPageMap.js
     so that browser fetch these data after the page loads -->
<script>
    // as 'process.env' exist at backend only. So, to access the mapbox public token id
    // we write the below code in separate script tag,
    // so that at backend EJS engine can run below code and replace it with the token
    // value to store in the mapToken variable
    // then that token id will be accessible
    // in the below included showPageMap.js file at the client-side by the browser
    const mapToken = '<%- process.env.MAPBOX_TOKEN %>';

    // provide campground data with converting JS object to JSON
    // (as _id value is alphanumeric and there would be no mongodb _id field at client-side,
    // so _id should be string there)
    const campground = <%- JSON.stringify(campground) %>;
    // as we only need coordinates, so we can only pass camground.geometry.coordinates instead
    
    /*
    VS code shows false-positive error in above code, as it do not understand EJS well
    If want, you can update below setting in vs-code
    "html.validate.scripts": false
    */
   
</script>

<script src="/javascripts/showPageMap.js"></script>